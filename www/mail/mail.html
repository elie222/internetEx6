<!DOCTYPE html>
<html>
<head>
    <title>Mail Application</title>
    <link rel="stylesheet" type="text/css" href="/mail/stylesheet.css" />
    <link rel="stylesheet" type="text/css" href="/mail/gui.css" />
    <link rel="stylesheet" type="text/css" href="/mail/include/jquery-ui.css" />
</head>
<body>
	<div id="container" class="clientArea">

            <div id="toolbar" class="window">
                <div id="userDetails">Show user name here</div>
                <input type="button" class="button" value="Show MailBox" onclick="buttonPushed('backToMailbox');"/>
                <input type="button" class="button" value="Compose New Mail" onclick="buttonPushed('composeNewEmail');"/>
                <input type="button" class="button" value="Logout"/>
            </div>

            <div id="mailList" class="window fullScreen">
                <table id="list">
                    <tr>
                        <th style="width:30px">From</th><th style="width:100px">Arrival Date:</th><th style="width:200px">  Subject</th><th style="width:50px">Actions</th>
                    </tr>
                </table>
            </div>

            <div id="composeDialog" class="window fullScreen">
                <form id="sendEmailForm">
                    <table class="input">
                        <tr style="height:50px">
                            <td style="width:100px">To: </td><td><input id="people" class="input" type="text" name="to"></td>
                        </tr>
                        <tr style="height:50px">
                            <td  style="width:100px">Subject: </td><td><input class="input" type="text" name="subject"></td>
                        </tr>
                        <tr>
                            <td  style="width:100px">Body: </td><td><textarea class="input" name="body" ></textarea></td>
                        </tr>
                        <tr style="height:50px; text-align: center" >
                           <td colspan="2" style="width:50px"><input type="submit" class="button" value="Send"> </td>
                        </tr>
                    </table>
                </form>
            </div>
    </div>

	<script type="text/javascript">
	    function buttonPushed(button) {
	        //console.log('HERE');
	        if (button === 'composeNewEmail') {
	            document.getElementById("composeDialog").style.display="block";
                document.getElementById("mailList").style.display="none";
	        }
            else if (button === 'backToMailbox') {
                document.getElementById("mailList").style.display="block";
                document.getElementById("composeDialog").style.display="none";
            }
            else {
	            console.log('not a button name');
	        }
	    }
	</script>

	<!-- FOR DISPLAYING EMAILS -->
    <script src="/mail/include/jquery.js"></script>
    <script src="/mail/include/jquery-ui.js"></script>
    <script>
        $(document).ready(function () {
            $.get('/mail/getLoggedInUsername', function (data, status) {
                if(status === "success") {
                    if(data === "FAIL") {
                        window.location.href = 'welcome.html';
                    }
                    else {
                        $('#userDetails').html("Welcome Back " + data + "!");
                    }
                }
            });

            $.post('/mail/mailList', {}, function (data, status) {
                if(status === "success") {
                    if(data === "FAIL") {
                        window.location.href = 'welcome.html';
                    }
                    else {
                        $('#list').append(data);
                    }
                }
            });

            $("#sendEmailForm").submit(function (event){
                //alert($(this).serialize());
                event.preventDefault();

                $.ajax({
                    type: 'POST',
                    url: '/mail/sendEmail',
                    data: $(this).serialize(),
                    success: function (data, status) {
                        //alert(data);
                        if (status === "success") {
                            alert('Your email has been successfully sent.');//TODO can remove this and just print a message on the mail.html page. alerts are annoying.
                            buttonPushed('backToMailbox');
                        } else {
                            alert('There was an error sending the email.\n' + data);
                        }
                    }
                });
            });
        });
    </script>
  <script>
  $(function() { 
    $( "#people" ).autocomplete({
      source: "/mail/getAllUsers",
      minLength: 1
    });
  });
  </script>
    <script>
        //$(function() {
        //     var availableTagsOrig = [
        //       "ActionScript",
        //       "AppleScript",
        //       "Asp",
        //       "BASIC",
        //       "C",
        //       "C++",
        //       "Clojure",
        //       "COBOL",
        //       "ColdFusion",
        //       "Erlang",
        //       "Fortran",
        //       "Groovy",
        //       "Haskell",
        //       "Java",
        //       "JavaScript",
        //       "Lisp",
        //       "Perl",
        //       "PHP",
        //       "Python",
        //       "Ruby",
        //       "Scala",
        //       "Scheme"
        //     ];
        //     var availableTags = [];
        //     $( "#people" ).autocomplete({
        //         source: availableTags
        //     });
        // });
    </script>
</body>
</html>